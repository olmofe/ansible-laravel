---
- name: Add PHP repository
  become: true
  apt_repository:
    repo: 'ppa:ondrej/php'

- name: Update apt
  apt: update_cache=yes

- name: Install php Prerequisites
  apt: name={{ item }} update_cache=yes state=latest
  loop: [ 'software-properties-common' ]
# - name: Install php8
#   apt: name={{ item }} update_cache=yes
#   loop: ['php7.2', 'libapache2-mod-php7.2', 'php7.2-fpm', 'php7.2-mysql', 'libapache2-mod-fcgid']

- name: Install Main PHP Packages
  apt: name={{ item }} update_cache=yes state=latest
  loop: [ 'php7.2-fpm', 'php7.2-pgsql' ]

- name: Install PHP Modules / Extensions
  apt: name={{ item }} update_cache=yes state=latest
  loop: "{{ php_packages }}"
  notify: 
    # - Restart apache2
    - Restart PHP-FPM
